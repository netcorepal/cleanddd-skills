---
name: cleanddd-modeling
description: 基于`cleanddd-requirements-analysis`的结果作为输入，可以输出符合CleanDDD原则的聚合、命令、事件、查询、Endpoint等模型。
---

# CleanDDD 建模技能

根据用户需求，设计符合CleanDDD原则的业务模型，包括聚合、命令、事件、查询等，确保模型的清晰性和可维护性。

## 核心原则

- 聚合之间边界明确，不直接或间接的相互引用
- 聚合之间不共享实体，允许共享值对象
- 领域事件由聚合行为产生
- 聚合之间的相互影响通过领域事件驱动

## 最佳实践

### 输入要求

- 前置输入：使用 `cleanddd-requirements-analysis` 产出的结构化结果（需求条目表、聚合映射、事件流、Endpoint/接口表等）作为建模输入。
- 若未提供上述结果，应先运行需求分析技能并与用户确认后再进入建模。

### 需求分析

- 需求拆解和条目化请参见独立技能：`cleanddd-requirements-analysis`（输出需求条目、聚合映射、事件流等结构化结果）。

### 定义模型

- 在定义模型前，需要与用户确认需求条目，确保理解一致

#### 定义聚合

- 当存在一个创建 x 的需求时，通常意味着需要一个新的聚合 x
- 当上述 x 实际上属于某个聚合的一部分时，则不创建新聚合，而是将其作为该聚合的实体或值对象
- 聚合之间不存在直接或间接引用关系
- 聚合之间允许共享值对象（如：枚举），但不允许共享实体

#### 定义命令

- 识别创建/修改/改变状态/删除等写操作需求，映射为命令（Command）

#### 定义查询

- 识别查看/检索等读操作需求，映射为查询（Query）

#### 定义事件与事件处理器

- 需求为`当x发生时，执行y操作`，通常意味着需要一个领域事件（DomainEvent）和对应的事件处理器（DomainEventHandler）

#### 定义Endpoint

- 针对产品功能交互需求，为每个用户场景设计对应的API Endpoint，确保接口清晰且符合聚合边界
- 需要标明认证/鉴权要求及幂等性说明

#### 定义定时任务

- 需求中涉及定时/周期性操作时，设计相应的定时任务

## 输出格式

- 使用结构化 Markdown，便于 Agent 解析与生成代码
- 包含以下主要部分：
  - 聚合
    - 聚合定义，包括属性、行为以及行为触发的事件
    - 聚合职责摘要以及对应的需求条目
  - 命令（Commands）
    - 列出每个命令的详细说明
    - 包括其操作的聚合以及聚合行为
  - 查询（Queries）
    - 列出每个查询的详细说明
  - 事件处理器
    - 列出每个事件处理器的详细说明
  - Endpoints
    - 列出每个API Endpoint的需求场景
    - 包括认证/鉴权要求及幂等性说明
    - 包括对应的命令或查询
  - 定时任务
    - 列出每个定时任务的需求场景
    - 包括执行频率及对应的命令和查询
- 统一命名与大小写：聚合/事件/命令用 PascalCase，枚举值用固定拼写
- 标明默认值与可选值，减少交互询问
- 在最终输出附“参数汇总 + 是否执行”提示，便于 Agent 向用户确认再行动
